---
title: "Data Wrangling Final Project"
author: "Peter J. Ehmann"
date: "Due: 5/6/2019"
output: html_document
---

```{r setup, include = FALSE}
library(broom)
library(jsonlite)
library(knitr)
library(rvest)
library(tidyverse)
library(xml2)
opts_chunk$set(echo = FALSE)
```

<br>

### Get smoking data. JSON.

```{r 2}
smoking_rates <- "https://chronicdata.cdc.gov/resource/gx47-p4ij.json" %>% 
  fromJSON() %>% 
  as_tibble() %>% 
  rename(state = locationdesc, abbr = locationabbr, year = year, percent = data_value) %>% 
  select(state, abbr, year, percent) %>% 
  group_by(state, abbr) %>% 
  nest(.key = smoking_rate)
```

<br>

### Get state taxation data. JSON.

```{r 3}
tax <- "https://chronicdata.cdc.gov/resource/7uzt-fasa.json" %>% 
  fromJSON() %>% 
  as.data.frame()
```

<br>

### Get state taxation data. XPATH.

```{r 3}
states_html <- read_html("https://simple.wikipedia.org/wiki/List_of_regions_of_the_United_States")

list_of_states <- states_html %>% 
  html_nodes(xpath = "//div/ul/li/ul/li/ul/li") %>% 
  html_text()

tbl <- as_tibble(data.frame(matrix(nrow = length(list_of_states), ncol = 3)))
colnames(tbl) <- c("state", "region", "division")
tbl[,1] <- list_of_states

division_names <- read_html(states_url) %>% 
  html_nodes(xpath = "//div/div/div/div/ul/li/ul/li") %>% 
  html_text() %>% 
  str_extract(., "\\(([^()]*)\\)")


```

Note.....

### Write tidied dataset as a .csv to current directory.

```{r write}
# df_clean %>% write_csv("Book1.csv")
```

<br>

### Read in provided .csv from GitHub repository.

```{r 4}
data <- read_csv("https://raw.githubusercontent.com/peter-ehmann/Data_Wrangling_Project_S2019/master/Book1.csv")
kable(data)
```

<br>

### Display information about the packages used, their versions, and the version of R that was used.

```{r sessionInfo}
devtools::sessionInfo()
```

